trigger:
  branches:
    include:
    - '*'
  paths:
    include:
    - 'LibraryApi/*'

pool:
  vmImage: 'ubuntu-latest'

variables:
  solution: 'LibraryApi/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

jobs:
  - job: build_and_test
    displayName: Build and Test
    steps:
    - task: DotNetCoreCLI@2
      displayName: Restore Packages
      inputs:
        command: 'restore'
        projects: ${{ variables.solution }}
        feedsToUse: 'select'

    - task: DotNetCoreCLI@2
      displayName: Build Solution
      inputs:
        command: 'build'
        projects: ${{ variables.solution }}

    - task: DotNetCoreCLI@2
      displayName: Test Solution
      inputs:
        command: 'test'
        projects: ${{ variables.solution }}
        arguments: '--collect:"XPlat Code Coverage"'
    
    - task: PublishCodeCoverageResults@2
      inputs:
        summaryFileLocation: '$(Agent.TempDirectory)/**/coverage.cobertura.xml'
